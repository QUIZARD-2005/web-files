 function submit()
    {
      //confirm("ARE YOU SURE TO SUBMIT TEST ?");
      var userResponse = confirm("Are you sure you want to proceed?");

if (userResponse) {
    // User clicked "OK"
    console.log("User clicked OK. Proceeding...");
  
      showResult();
 
} else {
    // User clicked "Cancel" or closed the dialog
    console.log("User clicked Cancel or closed the dialog. Action aborted.");
  alert("you can contine with your test")
}   
    }
    

    function startQuiz() {
     
       var qppbox = document.getElementById("qpbox");
    qppbox.style.display = "block";
      
    
      var instructions = document.getElementById("instructions");
      instructions.style.display = "none";

      var startBtn = document.getElementById("start-btn");
      startBtn.style.display = "none";

      var questionContainer = document.getElementById("question-container");
      questionContainer.style.display = "block";

      
 var opt = document.getElementById("optt");
      opt.style.display = "inline-block";



      startTime = new Date();
      displayQuestion();
     
    }


    function skipQuestion() {
      var question = questions[currentQuestion];
      question.skipped = true;
      question.userAnswer = null;
      question.timeTaken = getTimeTakenInSeconds();
      currentQuestion++;

      if (currentQuestion < questions.length) {
        displayQuestion();
      } else {
        showResult();
      }
    }

    function goToPreviousQuestion() {
      currentQuestion--;

      if (currentQuestion >= 0) {
        displayQuestion();
      }
    }

    function submitQuiz() {

     var question = questions[currentQuestion];


      if (question.type === "mcq") {
        var selectedOption = document.querySelector('input[name="option"]:checked');

        if (!selectedOption) {
          alert("Please select an option.");
          return;
        }

        var selectedValue = parseInt(selectedOption.value);
        question.userAnswer = selectedValue;
       // console.log(selectedValue);
      } else if (question.type === "integer") {
        var integerAnswerInput = document.getElementById("integer-answer");
        var integerAnswer = Math.round(integerAnswerInput.value);

        if (!integerAnswer) {
          alert("Please enter a valid integer.");
          return;
        }

        question.userAnswer = integerAnswer;
      }

      question.timeTaken = getTimeTakenInSeconds();

      currentQuestion++;

      if (currentQuestion < questions.length) {
        displayQuestion();
      } else {
        showResult();
      }
    }

    
    
 function showResult() {
  endTime = new Date();
   
    var op = document.getElementById("optt");
      op.style.display = "none";



  var quizContainer = document.getElementById("quiz");
  var resultContainer = document.getElementById("result");
  quizContainer.style.display = "none";
  resultContainer.style.display = "block";

  var incorrectAnswers = [];
  var totalScore = 0;
  var totalSkippedQuestionsCount = 0;
  var totalCorrectAnswers = 0;
  var totalTimeTaken = 0;

  var resultText = "<h3>Quiz completed.</h3><br>";

  // Group questions by section
  var questionsBySection = {};
  questions.forEach(function (question) {
    if (!questionsBySection[question.section]) {
      questionsBySection[question.section] = [];
    }
    questionsBySection[question.section].push(question);
  });

  // Display results by section
  Object.keys(questionsBySection).forEach(function (section) {
    resultText += "<hr>";
    resultText += "<h3>" + section + "</h3>";

    var sectionScore = 0;
    var sectionCorrectAnswers = 0;
    var sectionSkippedQuestionsCount = 0;

    
 questionsBySection[section].forEach(function (question, index) {
  resultText += "<div class='questiono'>Question No " + (index + 1) + ": </div> <br>" + question.question + "<br>";

  if (question.type === "mcq") {
    resultText += "Your Answer: ";
    if (question.userAnswer === null) {
      resultText += "<span class='incorrect-answer'>Question Skipped</span><br>";
      sectionSkippedQuestionsCount++;
    } else {
      resultText += "<span class='correct-answer'>" + question.options[question.userAnswer] + "</span><br>";
      if (question.userAnswer === question.answer) {
        sectionScore += question.marks.correct; // Use custom marks for correct answers
        sectionCorrectAnswers++;
      } else {
        sectionScore += question.marks.wrong; // Use custom marks for wrong answers
        incorrectAnswers.push(index + 1);
      }
    }

    resultText += "Correct Answer: <span class='correct-answer'>" + question.options[question.answer] + "</span><br><br><br>";
  } else if (question.type === "integer") {
    resultText += "Your Answer: ";

    if (question.userAnswer === question.answer) {
      resultText += "<span class='correct-answer'>" + question.userAnswer + "</span><br>";
      sectionScore += question.marks.correct; // Use custom marks for correct answers
      sectionCorrectAnswers++;
    } else if (question.userAnswer === null) {
      resultText += "<span class='incorrect-answer'>Question Skipped</span><br>";
      sectionSkippedQuestionsCount++;
    } else {
      resultText += "<span class='incorrect-answer'>" + question.userAnswer + "</span><br>";
      sectionScore += question.marks.wrong; // Use custom marks for wrong answers
      incorrectAnswers.push(index + 1);
    }

    resultText += "Correct Answer: <span class='correct-answer'>" + question.answer + "</span><br><br><br>";
    // ... (same logic for integer type questions)
  }

  totalTimeTaken += question.timeTaken;
});



   var sectionAccuracy = 0;

if (questionsBySection[section].length - sectionSkippedQuestionsCount > 0) {
  sectionAccuracy = (sectionCorrectAnswers / (questionsBySection[section].length - sectionSkippedQuestionsCount)) * 100;
}

    resultText += "<br>";
    resultText += "Section Result: <br>";
    resultText += "Total Questions: " + questionsBySection[section].length + "<br>";
    resultText += "Correct Answers: " + sectionCorrectAnswers + "<br>";
    resultText += "Skipped Questions: " + sectionSkippedQuestionsCount + "<br>";
    resultText += "Accuracy: " + sectionAccuracy.toFixed(2) + "%<br>";
    resultText += "Section Marks: <span id='score'>" + sectionScore + "</span><br>";

    totalScore += sectionScore;
    totalCorrectAnswers += sectionCorrectAnswers;
    totalSkippedQuestionsCount += sectionSkippedQuestionsCount;
  });

  resultText += "<hr>";
  resultText += "<h3>Overall Result </h3>";
  resultText += "<br>";
  resultText += "Total Questions: " + questions.length + "<br>";
  resultText += "Correct Answers: " + totalCorrectAnswers + "<br>";
  resultText += "Skipped Questions: " + totalSkippedQuestionsCount + "<br>";
  resultText += "Overall Accuracy: " + ((totalCorrectAnswers / (questions.length - totalSkippedQuestionsCount)) * 100).toFixed(2) + "%<br>";
  resultText += "Your Total Marks: <span id='score'>" + totalScore + "</span><br>";
  resultText += "Total Time Taken: " + formatTime(totalTimeTaken) + "<br>";

  resultText += '<br><br><button id="attachmentButton" onclick="showPopup()">Attachments Pdf</button>';
  resultContainer.innerHTML = resultText;
}




let i=0;

  function goToQuestion(questionIndex) {
  for (let i = currentQuestion + 1; i < questions.length; i++) {
   
      questions[i].skipped = true;

  }
  currentQuestion = questionIndex;

  displayQuestion();
}


// Updated JavaScript code for question palette highlighting
 function updateQuestionPalette() {
  var questionPalette = document.getElementById("questionPalette");
  questionPalette.innerHTML = "<button class='togleqboxbtn' onclick='toggleQuestionPalette()'>close box</button>"; // Clear existing content

  questions.forEach(function (question, index) {
    var sectionName = question.section;

    // If this is the first question of the section, add a section text
    if (index === 0 || question.section !== questions[index - 1].section) {
      var sectionText = document.createElement("p");
      sectionText.className = "palette-item section";
      sectionText.textContent = sectionName;
      questionPalette.appendChild(sectionText);
    }

    var questionButton = document.createElement("button");
    questionButton.className = "palette-item";
    questionButton.textContent = index + 1;

    if (index + 1 === currentQuestion + 1) {
      questionButton.classList.add("current"); // Add the "current" class for the current question
    } else if (question.markedForReview) {
      questionButton.classList.add("marked-for-review");
    }

    questionButton.addEventListener("click", function () {
      goToQuestion(index);
    });

    questionPalette.appendChild(questionButton);
  });
}


    function toggleQuestionPalette() {
      console.log("hii 1");
  var questionPalette = document.getElementById("questionPalette");
  var questionPaletteButton = document.getElementById("question-palette-button");

  if (questionPalette.style.display === "none") {
    questionPalette.style.display = "block";
    questionPaletteButton.textContent = "Hide Index";
  } else {
    questionPalette.style.display = "none";
    questionPaletteButton.textContent = "Show Index";
  }
}
   
 
   // Function to mark the current question for review
function markQuestionForReview() {
  var question = questions[currentQuestion];
  question.markedForReview = true;
  question.skipped = false;
  question.userAnswer = null;
  question.timeTaken = getTimeTakenInSeconds();
  updateQuestionPalette();
  currentQuestion++;
  if (currentQuestion < questions.length) {
    displayQuestion();
  } else {
    showResult();
  }
}

// Function to unmark and submit the current question
function unmarkAndSubmit() {
  var question = questions[currentQuestion];
  var selectedOption = document.querySelector('input[name="option"]:checked');

  if (!selectedOption) {
    alert("Please select an option before unmarking and submitting.");
    return;
  }

  // Record the user's answer
  question.userAnswer = parseInt(selectedOption.value);

  question.skipped = false;
  question.timeTaken = getTimeTakenInSeconds();

  if (question.markedForReview) {
    // Remove the "marked-for-review" class from the current question button in the palette
    var questionButton = document.querySelector("#questionPalette button.current");
    if (questionButton) {
      questionButton.classList.remove("marked-for-review");
    }

    question.markedForReview = false;
  }

  currentQuestion++;

  if (currentQuestion < questions.length) {
    displayQuestion();
  } else {
    showResult();
  }
  updateQuestionPalette();
}
